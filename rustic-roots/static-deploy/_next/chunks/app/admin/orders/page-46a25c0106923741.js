(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{3391:(e,t,s)=>{Promise.resolve().then(s.bind(s,9720))},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},9720:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var r=s(5155),a=s(2115),l=s(2108),d=s(5695),n=s(6874),i=s.n(n),o=s(4615);let c=[{value:"RECEIVED_ORDER",label:"Received Order",color:"bg-blue-100 text-blue-800"},{value:"REVIEWING_ORDER",label:"Reviewing Order",color:"bg-yellow-100 text-yellow-800"},{value:"WORK_IN_PROGRESS",label:"Work In Progress",color:"bg-purple-100 text-purple-800"},{value:"IN_SHIPPING",label:"In Shipping",color:"bg-orange-100 text-orange-800"},{value:"DELIVERED",label:"Delivered",color:"bg-green-100 text-green-800"}];function x(){var e,t;let{data:s,status:n}=(0,l.useSession)(),x=(0,d.useRouter)(),[u,m]=(0,a.useState)([]),[h,p]=(0,a.useState)(!0),[g,v]=(0,a.useState)(null),[j,y]=(0,a.useState)(""),[f,N]=(0,a.useState)(""),[b,w]=(0,a.useState)("ALL"),[k,E]=(0,a.useState)(null),[L,R]=(0,a.useState)("");async function S(){try{let e=await fetch("/api/orders",{credentials:"include",headers:{"Content-Type":"application/json"}});if(console.log("Orders API response status:",e.status),e.ok){let t=await e.json();console.log("Orders data received:",t.length,"orders"),m(t)}else{let t=await e.json().catch(()=>({}));console.error("Failed to fetch orders:",e.status,t),401===e.status?y("Failed to fetch orders: Not authenticated. Please log in as admin."):403===e.status?y("Failed to fetch orders: Access denied. Admin role required."):y("Failed to fetch orders: ".concat(e.status," ").concat(t.error||""))}}catch(e){console.error("Failed to fetch orders:",e),y("Failed to fetch orders: Network error")}finally{p(!1)}}(0,a.useEffect)(()=>{var e;if(console.log("Session status:",n),console.log("Session data:",s),"loading"!==n){if(!s||(null==(e=s.user)?void 0:e.role)!=="ADMIN"){console.log("Redirecting: no session or not admin"),x.push("/");return}console.log("Admin authenticated, fetching orders..."),S()}},[s,n,x]);let O=async(e,t)=>{v(e),y("");try{let r=await fetch("/api/orders/".concat(e,"/status"),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(r.ok){var s;let{data:a}=await r.json();m(t=>t.map(t=>t.id===e?a:t)),N("Order status updated to ".concat(null==(s=c.find(e=>e.value===t))?void 0:s.label)),setTimeout(()=>N(""),3e3)}else{let e=await r.json();y(e.error||"Failed to update order status")}}catch(e){console.error("Error updating order status:",e),y("Network error occurred")}finally{v(null)}},C=(e,t)=>{E(e),R(t||"")},I=()=>{E(null),R("")},A=async e=>{y("");try{let t=await fetch("/api/orders/".concat(e,"/notes"),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:L.trim()||null})});if(t.ok){let{data:s}=await t.json();m(t=>t.map(t=>t.id===e?s:t)),N("Order notes updated successfully"),setTimeout(()=>N(""),3e3),E(null),R("")}else{let e=await t.json();y(e.error||"Failed to update order notes")}}catch(e){console.error("Error updating order notes:",e),y("Network error occurred")}},D=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),_=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=e=>c.find(t=>t.value===e)||c[0],M="ALL"===b?u:u.filter(e=>e.status===b);return"loading"===n||h?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(o.default,{}),(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("div",{className:"text-xl",children:"Loading..."})})]}):s&&(null==(e=s.user)?void 0:e.role)==="ADMIN"?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(o.default,{}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Order Management"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Manage order statuses and track fulfillment"})]}),(0,r.jsxs)(i(),{href:"/admin",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 flex items-center",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Dashboard"]})]})}),f&&(0,r.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm font-medium text-green-800",children:f})})]})}),j&&(0,r.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm font-medium text-red-800",children:j})}),(0,r.jsx)("button",{onClick:()=>y(""),className:"ml-auto text-red-400 hover:text-red-600",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsxs)("button",{onClick:()=>w("ALL"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("ALL"===b?"bg-amber-800 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:["All Orders (",u.length,")"]}),c.map(e=>(0,r.jsxs)("button",{onClick:()=>w(e.value),className:"px-4 py-2 rounded-md text-sm font-medium ".concat(b===e.value?"bg-amber-800 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[e.label," (",u.filter(t=>t.status===e.value).length,")"]},e.value))]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Notes"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map(e=>{let t=P(e.status);return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["#",e.id.slice(-8)]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:_(e.createdAt)})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.user.name}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.user.email})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.items.map((e,t)=>(0,r.jsxs)("div",{className:t>0?"mt-1":"",children:[e.quantity,"x ",e.product.name]},e.id))})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:D(e.total)}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(t.color),children:t.label}),e.updatedAt!==e.createdAt&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Updated: ",_(e.updatedAt)]})]}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:k===e.id?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("textarea",{value:L,onChange:e=>R(e.target.value),placeholder:"Add notes for this order...",className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 bg-white text-gray-900",rows:3}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>A(e.id),className:"px-3 py-1 bg-amber-800 text-white text-xs rounded hover:bg-amber-900",children:"Save"}),(0,r.jsx)("button",{onClick:I,className:"px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400",children:"Cancel"})]})]}):(0,r.jsx)("div",{className:"max-w-xs",children:e.notes?(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-900 mb-1 break-words",children:e.notes}),(0,r.jsx)("button",{onClick:()=>C(e.id,e.notes),className:"text-xs text-amber-600 hover:text-amber-800",children:"Edit notes"})]}):(0,r.jsx)("button",{onClick:()=>C(e.id,null),className:"text-xs text-gray-500 hover:text-amber-600",children:"Add notes"})})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,r.jsx)("select",{value:e.status,onChange:t=>O(e.id,t.target.value),disabled:g===e.id,className:"text-sm border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-amber-500 disabled:opacity-50 bg-white text-gray-900",children:c.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),g===e.id&&(0,r.jsx)("div",{className:"text-xs text-amber-600",children:"Updating..."})]})})]},e.id)})})]})}),0===M.length&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),(0,r.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No orders found"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"ALL"===b?"No orders have been placed yet.":'No orders with status "'.concat(null==(t=c.find(e=>e.value===b))?void 0:t.label,'".')})]})]}),(0,r.jsxs)("div",{className:"mt-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Status Guide"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:c.map((e,t)=>(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center mb-2",children:[(0,r.jsxs)("span",{className:"text-lg font-bold text-gray-900 mr-2",children:[t+1,"."]}),(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(e.color),children:e.label})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["RECEIVED_ORDER"===e.value&&"Order has been received and is awaiting review.","REVIEWING_ORDER"===e.value&&"Order details are being reviewed and confirmed.","WORK_IN_PROGRESS"===e.value&&"Furniture is being crafted in the workshop.","IN_SHIPPING"===e.value&&"Order has been shipped and is in transit.","DELIVERED"===e.value&&"Order has been successfully delivered to customer."]})]},e.value))})]})]})]}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[108,874,615,441,684,358],()=>t(3391)),_N_E=e.O()}]);